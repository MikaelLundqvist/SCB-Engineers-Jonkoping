# SSYK 214

## Average monthly salary, SEK by region

Genomsnittlig grund- och månadslön samt kvinnors lön i procent av mäns lön efter region sektor, yrkesgrupp (SSYK 2012) och kön. År 2014 - 2018
Månadslön
Samtliga sektorer
214 Cilvilingenjörsyrken
Kön totalt
2017

```{r 214sweden, echo = TRUE, fig.cap = 'Engineers salaries in the different countys'} 
readfile ("000000CG_1.csv") %>%
  left_join(nuts, by = c("region" = "NUTS2")) %>%
  right_join(map_ln_n, by = c("Länskod" = "lnkod_n")) %>%
  ggplot() +
    geom_polygon(mapping = aes(x = ggplot_long, y = ggplot_lat, group = lnkod, fill = relsalary)) +
    coord_equal() 
```
	
```{r women, echo = TRUE, fig.cap = 'The correlation between the proportion of engineers who are women and the salaries of engineers in the region.'}
salary_2017 <- readfile ("000000CG_1.csv") %>%
  left_join(nuts, by = c("region" = "NUTS2"))

readfile ("000000NL_3.csv") %>%   
  group_by (`region`, year) %>%   
  summarise (perc_women = perc_women (salary)) %>%
  mutate(perc_women_n = as.numeric(sub("%", "", perc_women))) %>%
  mutate(lnkod_n = as.numeric(substr(region, 1,2)))%>%
  right_join(salary_2017, by = c("lnkod_n" = "Länskod")) %>%
  ggscatter(x = "relsalary", y = "perc_women_n", 
    add = "reg.line", conf.int = TRUE, 
    cor.coef = TRUE, cor.method = "pearson")  	
``` 

## Number of men and women in SSYK 214 and the percentage of women in SSYK 214 Year 2014 - 2018
Average basic salary, monthly salary and women´s salary as a percentage of men´s salary by sector, occupational group (SSYK 2012), sex and educational level (SUN). Year 2014 - 2018
Number of employees
All sectors
214, Architects, engineers and related professionals
```{r 214percwomen, echo = TRUE, fig.cap = 'Number of men and women in SSYK 214 and the percentage of women in SSYK 214 Year 2014 - 2018'}
readfile("000000CV_3.csv") %>%   
  group_by (year) %>%   
  mutate (perc_women = as.numeric (sub ("%", "", perc_women (salary)))) %>%
  ggplot(aes(x = year2)) +
  geom_line(mapping = aes(y = salary, colour = sex)) +
  geom_line(mapping = aes(y = perc_women * 2000)) +
  scale_y_continuous(sec.axis = sec_axis(~ . * 0.0005, name = "Percent women [%]"))
```

## Number of men and women in SSYK 214 and the percentage of women in SSYK 214 Year 2003 - 2013
Average basic salary, monthly salary and women´s salary as a percentage of men´s salary by sector, occupational group (SSYK), sex and educational level (SUN). Year 2003 - 2013
Number of employees
All sectors
214, Architects, engineers and related professionals
```{r 214percwomen2, echo = TRUE, fig.cap = 'Number of men and women in SSYK 214 and the percentage of women in SSYK 214 Year 2003 - 2013'}
readfile("AM0110B4.csv") %>%   
  group_by (year) %>%   
  mutate (perc_women = as.numeric (sub ("%", "", perc_women (salary)))) %>%
  ggplot(aes(x = year2)) +
  geom_line(mapping = aes(y = salary, colour = sex)) +
  geom_line(mapping = aes(y = perc_women * 2000)) +
  scale_y_continuous(sec.axis = sec_axis(~ . * 0.0005, name = "Percent women [%]"))
```


## Age distribution in the different countys

Employees 16-64 years by region of work, occupation (3-digit SSYK 2012), age and sex. Year 2014 - 2017
occupation=214, Architects, engineers and related professionals

```{r 214age, echo = TRUE, fig.cap = 'The age distribution in the different countys for engineers, year 2017'}
readfile("000000NK.csv") %>% filter(year2 == 2017) %>%
  rowwise() %>% mutate(age2 = unlist(lapply(strsplit(substr(age, 1, 5), "-"), strtoi))[1]) %>% 
  rowwise() %>% mutate(age3 = unlist(lapply(strsplit(substr(age, 1, 5), "-"), strtoi))[2]) %>%
  ggplot() +
    geom_line(aes(x = (age2 + age3) / 2, y = salary, color = region)) +
    theme(legend.position="bottom") +
    facet_grid(. ~ sex)
```

## Sector distribution in the different countys

Employees 16-64 years by region of work, occupation (3-digit SSYK 2012), sector and sex. Year 2014 - 2017
occupation=214, Architects, engineers and related professionals

```{r 214sector, echo = TRUE, fig.cap = 'The sector distribution in the different countys for engineers, year 2017'}
readfile("000000RM_1.csv") %>% 
  filter(year2 == 2017) %>%
  mutate(lnkod_n = substr(region, 1,2))%>%
  ggplot(aes(x = lnkod_n, y = salary, fill = sector)) +
    geom_col(position = "fill") +
    theme(legend.position="bottom") +
    facet_grid(. ~ sex)
```

## Education distribution for engineers

Number of employees by sector, occuptional (SSYK 2012), sex, level of education and year
214 Engineering professionals
All sectors
Year 2017

```{r 214edu, echo = TRUE, fig.cap = 'The education distribution for engineers, year 2017'}
edu <- readfile("000000CV_1.csv")
edu$`level of education` <- as.factor(edu$`level of education`)
edu$`level of education` <- factor(edu$`level of education`, levels(edu$`level of education`)[c(2, 3, 4, 6, 7, 5, 1)])
edu %>%
  filter(year2 == 2017) %>%  
  ggplot(aes(x = `occuptional  (SSYK 2012)`, y = salary, fill = `level of education`)) +
    geom_col(position = "fill") +
    theme(legend.position="bottom") +
    facet_grid(. ~ sex)	
```

## Average monthly pay increase by occuption year 2000 - 2013

Average monthly pay (total pay), non-manual workers private sector (SLP), SEK by occuptional (SSYK 2012), age, sex and year, Year 2000 - 2013	  
age=total  
sex=total  

Average monthly pay (total pay), non-manual workers private sector (SLP), SEK by occuptional (SSYK 2012), age, sex and year, Year 2014 - 2018  
age=total  
sex=total  
 
	    
```{r occuptionpay, echo = TRUE}  
readfile ("AM0103E6.csv") %>%   
  group_by (`occupational group (SSYK)`) %>%   
  summarise (tot = tot_dev (salary)) %>%  
  arrange (desc (tot)) %>%
  knitr::kable( 
  booktabs = TRUE,
  caption = 'Average monthly pay increase by occuption (SSYK 2012), Year 2000 - 2013')  

readfile ("00000031.csv") %>%   
  group_by (`occuptional  (SSYK 2012)`) %>%   
  summarise (tot = parse_number (tot_dev (salary))) %>%  
  arrange (desc (tot)) %>%
  knitr::kable( 
  booktabs = TRUE,
  caption = 'Average monthly pay increase by occuption (SSYK 2012), Year 2014 - 2018')  
``` 

## SSYK 214, Architects, engineers and related professionals, Year 2000 - 2013

Average monthly pay, non-manual workers private sector (SLP) by occupational 
group (SSYK) age and sex. Year 2000 - 2013
Average monthly pay (total pay), non-manual workers private sector (SLP), SEK 
by occupational group (SSYK), age, sex and year

```{r ssyk00-13, echo = TRUE, fig.cap = 'SSYK 214, Architects, engineers and related professionals, Year 2000 - 2013'}
tb <- readfile("AM0103A9_1.csv") %>% 
  rowwise() %>% 
  mutate(age2 = unlist(lapply(strsplit(substr(age, 1, 5), "-"), strtoi))[1]) %>%  
  rowwise() %>% 
  mutate(age3 = unlist(lapply(strsplit(substr(age, 1, 5), "-"), strtoi))[2]) %>% 
  mutate(age4 = (age3 + age2) / 2) %>% 
  group_by (`occupational group (SSYK)`, age, sex) %>%   
  mutate (grouprelsal = relative_dev (salary))  
  
tb %>%
  ggplot () +  
    geom_point (mapping = aes(x = year2,y = log(salary), colour = age, shape=sex))  
	
model <- lm (log(salary) ~ year2 + sex + poly(age4, 3), data = tb)

```{r ssyk00-13_2, echo = TRUE, fig.cap = 'SSYK, Year 2000 - 2013'} 
tb <- bind_cols(tb, as_tibble(exp(predict(model, tb, interval = "confidence"))))

tb %>%
  ggplot () +  
    geom_point (mapping = aes(x = year2,y = log(fit), colour = age, shape=sex))
	
summary(model) %>%	
  tidy() %>%
  knitr::kable( 
  booktabs = TRUE,
  caption = 'Summary from linear model fit')

Anova(model, type=2) %>% 
  tidy() %>% 
  knitr::kable( 
  booktabs = TRUE,
  caption = 'Anova report from linear model fit')  
  
tb <- readfile("AM0103A9_2.csv") %>% 
  rowwise() %>% 
  mutate(age2 = unlist(lapply(strsplit(substr(age, 1, 5), "-"), strtoi))[1]) %>%  
  rowwise() %>% 
  mutate(age3 = unlist(lapply(strsplit(substr(age, 1, 5), "-"), strtoi))[2]) %>% 
  mutate(age4 = (age3 + age2) / 2) %>% 
  group_by (`occupational group (SSYK)`, age, sex) %>%   
  mutate (grouprelsal = relative_dev (salary))  
   	
model <- lm (log(salary) ~ `occupational group (SSYK)` + year2 + sex + poly(age4, 3), data = tb)
	
summary(model) %>%	
  tidy() %>%
  knitr::kable( 
  booktabs = TRUE,
  caption = 'Summary from linear model fit')

Anova(model, type=2) %>% 
  tidy() %>% 
  knitr::kable( 
  booktabs = TRUE,
  caption = 'Anova report from linear model fit')
```

## SSYK 214, Architects, engineers and related professionals, Year 2014 - 2018

Average monthly pay, non-manual workers private sector (SLP) by occupational 
group (SSYK 2012) age and sex. Year 2014 - 2018
Average monthly pay (total pay), non-manual workers private sector (SLP), SEK 
by occupational group (SSYK), age, sex and year

```{r ssyk14-18, echo = TRUE, fig.cap = 'SSYK 214, Architects, engineers and related professionals, Year 2014 - 2018'}   
tb <- readfile("00000031_1.csv") %>% 
  rowwise() %>% 
  mutate(age2 = unlist(lapply(strsplit(substr(age, 1, 5), "-"), strtoi))[1]) %>%  
  rowwise() %>% 
  mutate(age3 = unlist(lapply(strsplit(substr(age, 1, 5), "-"), strtoi))[2]) %>% 
  mutate(age4 = (age3 + age2) / 2) %>% 
  group_by (`occuptional  (SSYK 2012)`, age, sex) %>%   
  mutate (grouprelsal = relative_dev (salary))  
   
tb %>%
  ggplot () +  
    geom_point (mapping = aes(x = year2,y = log(salary), colour = age, shape=sex))  
	
model <- lm (log(salary) ~ year2 + sex + poly(age4, 3), data = tb)

tb <- bind_cols(tb, as_tibble(exp(predict(model, tb, interval = "confidence"))))
```

```{r ssyk14-18_2, echo = TRUE, fig.cap = 'Model fit, SSYK 214, Architects, engineers and related professionals, Year 2014 - 2018'}
tb %>%
  ggplot () +  
    geom_point (mapping = aes(x = year2,y = log(fit), colour = age, shape=sex))
	
summary(model) %>%	
  tidy() %>%
  knitr::kable( 
  booktabs = TRUE,
  caption = 'Summary from linear model fit')

Anova(model, type=2) %>% 
  tidy() %>% 
  knitr::kable( 
  booktabs = TRUE,
  caption = 'Anova report from linear model fit')

tb <- readfile("00000031_3.csv") %>% 
  rowwise() %>% 
  mutate(age2 = unlist(lapply(strsplit(substr(age, 1, 5), "-"), strtoi))[1]) %>%  
  rowwise() %>% 
  mutate(age3 = unlist(lapply(strsplit(substr(age, 1, 5), "-"), strtoi))[2]) %>% 
  mutate(age4 = (age3 + age2) / 2) %>% 
  group_by (`occuptional  (SSYK 2012)`, age, sex) %>%   
  mutate (grouprelsal = relative_dev (salary))
   	
model <- lm (log(salary) ~ `occuptional  (SSYK 2012)` + year2 + sex + poly(age4, 3), data = tb)
	
summary(model) %>%	
  tidy() %>%
  knitr::kable( 
  booktabs = TRUE,
  caption = 'Summary from linear model fit')

Anova(model, type=2) %>% 
  tidy() %>% 
  knitr::kable( 
  booktabs = TRUE,
  caption = 'Anova report from linear model fit')  
```  
  
  
## SSYK 214, Architects, engineers and related professionals by region, Year 2000 - 2018  

Average monthly pay, non-manual workers private sector (SLP) by region, 
occupational group (SSYK) and sex. Year 2000 - 2013
Average monthly pay (total pay), non-manual workers private sector (SLP)
214 Engineering professionals 

```{r ssyk00-13_3, echo = TRUE, fig.cap = 'Model fit, SSYK 214, Architects, engineers and related professionals, Year 2000 - 2013'}
tb <- readfile("AM0103H2_4.csv") %>%
    filter(year2 > 1994) %>%
    group_by (`occupational group (SSYK)`, region, sex) %>%   
    mutate (grouprelsal = relative_dev (salary))

model <- lm (log(salary) ~ year2 + region + sex, data = tb)
	
summary(model) %>%	
  tidy() %>%
  knitr::kable( 
  booktabs = TRUE,
  caption = 'Summary from linear model fit')

Anova(model, type=2) %>% 
  tidy() %>% 
  knitr::kable( 
  booktabs = TRUE,
  caption = 'Anova report from linear model fit') 
``` 

Average monthly pay, non-manual workers private sector (SLP) by region, 
occupational group (SSYK 2012) and sex. Year 2014 - 2018
Average monthly pay (total pay), non-manual workers private sector (SLP)
214 Engineering professionals 	  

```{r ssyk14-18_3, echo = TRUE, fig.cap = 'Model fit, SSYK 214, Architects, engineers and related professionals, Year 2014 - 2018'}	  
tb <- readfile("0000002T_1.csv") %>%
    filter(year2 > 1994) %>%
    group_by (`occuptional  (SSYK 2012)`, region, sex) %>%   
    mutate (grouprelsal = relative_dev (salary))

model <- lm (log(salary) ~ year2 + region + sex, data = tb)
	
summary(model) %>%	
  tidy() %>%
  knitr::kable( 
  booktabs = TRUE,
  caption = 'Summary from linear model fit')

Anova(model, type=2) %>% 
  tidy() %>% 
  knitr::kable( 
  booktabs = TRUE,
  caption = 'Anova report from linear model fit') 
``` 

## Level of education , SSYK 214, Architects, engineers and related professionals

Average basic salary, monthly salary and women´s salary as a percentage of 
men´s salary by sector, occupational group (SSYK 2012), sex and educational 
level (SUN). Year 2014 - 2018
Monthly salary
5 non-manual workers private sector
214 Engineering professionals

```{r ssyk14-18_4, echo = TRUE}	
tb <- readfile("000000CY.csv") %>%
    group_by (`level of education`, sex) %>%   
    mutate (grouprelsal = relative_dev (salary))

model <- lm (log(salary) ~ `level of education` + sex + year2, data = tb)
	
summary(model) %>%	
  tidy() %>%
  knitr::kable( 
  booktabs = TRUE,
  caption = 'Level of education for SSYK 214')

Anova(model, type=2) %>% 
  tidy() %>% 
  knitr::kable( 
  booktabs = TRUE,
  caption = 'Anova report from linear model fit') 
``` 

## The correlation between the proportion of engineers who are women and the salaries of engineers in the region. Year 2014 - 2018
Average basic salary, monthly salary and women´s salary as a percentage of men´s salary by region, sector, occupational group (SSYK 2012) and sex . Year 2014 - 2018
Monthly salaty
All sectors
214 Engineering professionals

Average basic salary, monthly salary and women´s salary as a percentage of men´s salary by region, sector, occupational group (SSYK 2012) and sex . Year 2014 - 2018
Number of employees
All sectors
214 Engineering professionals

```{r ssyk14-18_5, echo = TRUE}	
tb <- readfile("000000CG_10.csv")
tb <- readfile("000000CD_10.csv") %>% 
  left_join(tb, by = c("region", "year", "sex")) %>%
  group_by (`region`, year) %>%   
  mutate (perc_women = as.numeric (sub ("%", "", perc_women (salary.x))))
  
model <- lm (log(salary.y) ~ year2.x + perc_women, data = tb)
	
summary(model) %>%	
  tidy() %>%
  knitr::kable( 
  booktabs = TRUE,
  caption = 'The correlation between the proportion of engineers who are women and the salaries of engineers in the region.')

Anova(model, type=2) %>% 
  tidy() %>% 
  knitr::kable( 
  booktabs = TRUE,
  caption = 'Anova report from linear model fit') 
``` 

## The correlation between the proportion of engineers who are women and the salaries of engineers in the region. Year 2003 - 2013
Average basic salary, monthly salary and women´s salary as a percentage of men´s salary by region, sector, occupational group (SSYK 2012) and sex . Year 2003 - 2013
Number of employees
All sectors
214 Engineering professionals

```{r ssyk14-18_6, echo = TRUE}	
tb <- readfile("AM0110A2.csv")
tb <- readfile("AM0110A4.csv") %>% 
  left_join(tb, by = c("region", "year", "sex")) %>%
  group_by (`region`, year) %>%   
  mutate (perc_women = as.numeric (sub ("%", "", perc_women (salary.x))))
  
model <- lm (log(salary.y) ~ year2.x + perc_women, data = tb)
	
summary(model) %>%	
  tidy() %>%
  knitr::kable( 
  booktabs = TRUE,
  caption = 'The correlation between the proportion of engineers who are women and the salaries of engineers in the region.')

Anova(model, type=2) %>% 
  tidy() %>% 
  knitr::kable( 
  booktabs = TRUE,
  caption = 'Anova report from linear model fit') 
``` 

## F-value for age compared to yearly increase in salary cleaned for the effect of age, Year 2004 - 2013
Average basic salary, monthly salary and women´s salary as a percentage of men´s salary by sector, occupational group (SSYK) , sex and age. Year 2004 - 2013
Monthly salary
All sectors

```{r ssyk14-18_7, echo = TRUE, fig.cap = 'F-value for age compared to yearly increase in salary cleaned for the effect of age'}	
tb <- readfile("AM0110E2.csv") %>%
  rowwise() %>% 
  mutate(age2 = unlist(lapply(strsplit(substr(age, 1, 5), "-"), strtoi))[1]) %>%  
  rowwise() %>% 
  mutate(age3 = unlist(lapply(strsplit(substr(age, 1, 5), "-"), strtoi))[2]) %>% 
  mutate(age4 = (age3 + age2) / 2)
  
summary_table = 0
anova_table = 0
for (i in unique(tb$`occupational group (SSYK)`)){
  temp <- filter(tb, `occupational group (SSYK)` == i)
  if (dim(temp)[1] > 50){
    model <- lm (log(salary) ~ year2 + sex + poly(age4, 3), data = temp)
    summary_table <- rbind (summary_table, mutate (mutate (tidy (summary (model)), ssyk = i), spannvidd = max (filter (temp, year2 == 2013)$salary) / min (filter (temp, year2 == 2013)$salary)))
    anova_table <- rbind (anova_table, mutate (tidy (Anova (model, type = 2)), ssyk = i))
  }
}

merge(summary_table, anova_table, by = "ssyk", all = TRUE) %>% 
  filter (term.y == "poly(age4, 3)") %>% 
  filter (term.x == "year2") %>%
  ggplot () + 
    geom_point (mapping = aes(x = estimate, y = statistic.y))
	
merge(summary_table, anova_table, by = "ssyk", all = TRUE) %>% 
  filter (term.y == "poly(age4, 3)") %>% 
  filter (term.x == "year2") %>%
  select (ssyk, estimate, statistic.y) %>%
  arrange (desc (statistic.y)) %>%
  knitr::kable( 
  booktabs = TRUE,
  caption = 'Correlation for F-value (age) and yearly increase in salaries cleaned for the effect of age') 
```  

## F-value for age compared to yearly increase in salary cleaned for the effect of age, Year 2014 - 2018
Average basic salary, monthly salary and women´s salary as a percentage of men´s salary by sector, occupational group (SSYK 2012) , sex and age. Year 2014 - 2018
Monthly salary
All sectors

```{r ssyk14-18_8, echo = TRUE, fig.cap = 'F-value for age compared to yearly increase in salary cleaned for the effect of age'}	
tb <- readfile("000000D2_1.csv") %>%
  rowwise() %>% 
  mutate(age2 = unlist(lapply(strsplit(substr(age, 1, 5), "-"), strtoi))[1]) %>%  
  rowwise() %>% 
  mutate(age3 = unlist(lapply(strsplit(substr(age, 1, 5), "-"), strtoi))[2]) %>% 
  mutate(age4 = (age3 + age2) / 2)
  
summary_table = 0
anova_table = 0
for (i in unique(tb$`occuptional  (SSYK 2012)`)){
  temp <- filter(tb, `occuptional  (SSYK 2012)` == i)
  if (dim(temp)[1] > 50){
    model <- lm (log(salary) ~ year2 + sex + poly(age4, 3), data = temp)
    summary_table <- rbind (summary_table, mutate (mutate (tidy (summary (model)), ssyk = i), spannvidd = max (filter (temp, year2 == 2018)$salary) / min (filter (temp, year2 == 2018)$salary)))
    anova_table <- rbind (anova_table, mutate (tidy (Anova (model, type = 2)), ssyk = i))
  }
}

merge(summary_table, anova_table, by = "ssyk", all = TRUE) %>% 
  filter (term.y == "poly(age4, 3)") %>% 
  filter (term.x == "year2") %>%
  ggplot () + 
    geom_point (mapping = aes(x = estimate, y = statistic.y))
	
merge(summary_table, anova_table, by = "ssyk", all = TRUE) %>% 
  filter (term.y == "poly(age4, 3)") %>% 
  filter (term.x == "year2") %>%
  select (ssyk, estimate, statistic.y) %>%
  arrange (desc (statistic.y)) %>%
  knitr::kable( 
  booktabs = TRUE,
  caption = 'Correlation for F-value (age) and yearly increase in salaries cleaned for the effect of age') 
```  

## Women's urbanization, comparison between the SSYK, population dependence, Year 2003 - 2013
Average basic salary, monthly salary and women´s salary as a percentage of men´s salary by region, sector, occupational group (SSYK) and sex. Year 2003 - 2013
Number of employees
All sectors
```{r ssyk14-18_9, echo = TRUE, fig.cap = 'Womens urbanization, comparison between the SSYK, Year 2014 - 2018, positive x = tendency for women within SSYK to migrate to larger regions, negative x = tendency for women within SSYK to migrate to smaller regions'}	
tb <- readfile("AM0110A4_2.csv")
  
summary_table = 0
anova_table = 0
tb <- tb %>%
  group_by (`region`, year, `occupational group (SSYK)`) %>%
  mutate (perc_women = as.numeric (sub ("%", "", perc_women (salary)))) %>%
  group_by(region, year) %>%
  mutate(sum_pop = sum(salary))
for (i in unique(tb$`occupational group (SSYK)`)){
  temp <- filter(tb, `occupational group (SSYK)` == i)
  if (dim(temp)[1] > 50){
    model <- lm(perc_women ~ sum_pop + year2, data = temp)
    summary_table <- rbind (summary_table, mutate (mutate (tidy (summary (model)), ssyk = i), spannvidd = max (filter (temp, year2 == 2013)$salary) / min (filter (temp, year2 == 2013)$salary)))
    anova_table <- rbind (anova_table, mutate (tidy (Anova (model, type = 2)), ssyk = i))
  }
}  

merge(summary_table, anova_table, by = "ssyk", all = TRUE) %>% 
  filter (term.y == "sum_pop") %>% 
  filter (term.x == "sum_pop") %>%
  ggplot () + 
    geom_point (mapping = aes(x = estimate, y = statistic.y)) +
    labs(
      x = "estimate",
      y = "F value for SSYK"
    )	

merge(summary_table, anova_table, by = "ssyk", all = TRUE) %>% 
  filter (term.y == "sum_pop") %>% 
  filter (term.x == "sum_pop") %>%
  select (ssyk, estimate, statistic.y) %>%
  arrange (desc (statistic.y)) %>%
  knitr::kable( 
  booktabs = TRUE,
  caption = 'Womens urbanization, comparison between the SSYK, Year 2003 - 2013')    
```

## Women's urbanization, comparison between the SSYK, population dependence, Year 2014 - 2018
Average basic salary, monthly salary and women´s salary as a percentage of men´s salary by region, sector, occupational group (SSYK 2012) and sex . Year 2014 - 2018
Number of employees
All sectors
```{r ssyk14-18_10, echo = TRUE, fig.cap = 'Womens urbanization, comparison between the SSYK, Year 2014 - 2018, positive x = tendency for women within SSYK to migrate to larger regions, negative x = tendency for women within SSYK to migrate to smaller regions'}	
tb <- readfile("000000CD_13.csv")
  
summary_table = 0
anova_table = 0
tb <- tb %>%
  group_by (`region`, year, `occuptional  (SSYK 2012)`) %>%
  mutate (perc_women = as.numeric (sub ("%", "", perc_women (salary)))) %>%
  group_by(region, year) %>%
  mutate(sum_pop = sum(salary))
for (i in unique(tb$`occuptional  (SSYK 2012)`)){
  temp <- filter(tb, `occuptional  (SSYK 2012)` == i)
  if (dim(temp)[1] > 50){
    model <- lm(perc_women ~ sum_pop + year2, data = temp)
    summary_table <- rbind (summary_table, mutate (mutate (tidy (summary (model)), ssyk = i), spannvidd = max (filter (temp, year2 == 2018)$salary) / min (filter (temp, year2 == 2018)$salary)))
    anova_table <- rbind (anova_table, mutate (tidy (Anova (model, type = 2)), ssyk = i))
  }
}  

merge(summary_table, anova_table, by = "ssyk", all = TRUE) %>% 
  filter (term.y == "sum_pop") %>% 
  filter (term.x == "sum_pop") %>%
  ggplot () + 
    geom_point (mapping = aes(x = estimate, y = statistic.y)) +
    labs(
      x = "estimate",
      y = "F value for SSYK"
    )	

merge(summary_table, anova_table, by = "ssyk", all = TRUE) %>% 
  filter (term.y == "sum_pop") %>% 
  filter (term.x == "sum_pop") %>%
  select (ssyk, estimate, statistic.y) %>%
  arrange (desc (statistic.y)) %>%
  knitr::kable( 
  booktabs = TRUE,
  caption = 'Womens urbanization, comparison between the SSYK, Year 2014 - 2018')    
```

## Women's urbanization, comparison between the SSYK, salary dependence, Year 2003 - 2013
Average basic salary, monthly salary and women´s salary as a percentage of men´s salary by region, sector, occupational group (SSYK) and sex. Year 2003 - 2013
Number of employees
All sectors

Monthly salary
All sectors

```{r ssyk14-18_11, echo = TRUE, fig.cap = 'Womens urbanization, comparison between the SSYK, Year 2003 - 2013, positive x = tendency for women within SSYK to migrate to regions with higher salaries, negative x = tendency for women within SSYK to migrate to regions with lower salaries'}	
tb <- readfile("AM0110A4_2.csv")

summary_table = 0
anova_table = 0
tb <- tb %>%
  group_by (`region`, year, `occupational group (SSYK)`) %>%
  mutate (perc_women = as.numeric (sub ("%", "", perc_women (salary)))) %>%
  group_by(region, year) %>%
  mutate(sum_pop = sum(salary))
tb <- readfile("AM0110A2_2.csv") %>% 
  inner_join(tb, by = c("region", "year", "sex", "occupational group (SSYK)"))  
for (i in unique(tb$`occupational group (SSYK)`)){
  temp <- filter(tb, `occupational group (SSYK)` == i)
  if (dim(temp)[1] > 50){
    model <- lm(perc_women ~ log(salary.x) + year2.x + sex, data = temp)
    summary_table <- rbind (summary_table, mutate (mutate (tidy (summary (model)), ssyk = i)))
    anova_table <- rbind (anova_table, mutate (tidy (Anova (model, type = 2)), ssyk = i))
  }
}  
 
merge(summary_table, anova_table, by = "ssyk", all = TRUE) %>% 
  filter (term.y == "log(salary.x)") %>% 
  filter (term.x == "log(salary.x)") %>%
  ggplot () + 
    geom_point (mapping = aes(x = estimate, y = statistic.y)) +
    labs(
      x = "estimate",
      y = "F value for SSYK"
    )	
	
merge(summary_table, anova_table, by = "ssyk", all = TRUE) %>% 
  filter (term.y == "log(salary.x)") %>% 
  filter (term.x == "log(salary.x)") %>%
  select (ssyk, estimate, statistic.y) %>%
  arrange (desc (statistic.y)) %>%
  knitr::kable( 
  booktabs = TRUE,
  caption = 'Womens urbanization, comparison between the SSYK, Year 2003 - 2013') 	
```

## Women's urbanization, comparison between the SSYK, salary dependence, Year 2014 - 2018
Average basic salary, monthly salary and women´s salary as a percentage of men´s salary by region, sector, occupational group (SSYK 2012) and sex . Year 2014 - 2018
Number of employees
All sectors

Monthly salary
All sectors

```{r ssyk14-18_12, echo = TRUE, fig.cap = 'Womens urbanization, comparison between the SSYK, Year 2014 - 2018, positive x = tendency for women within SSYK to migrate to regions with higher salaries, negative x = tendency for women within SSYK to migrate to regions with lower salaries'}	
tb <- readfile("000000CD_13.csv")

summary_table = 0
anova_table = 0
tb <- tb %>%
  group_by (`region`, year, `occuptional  (SSYK 2012)`) %>%
  mutate (perc_women = as.numeric (sub ("%", "", perc_women (salary)))) %>%
  group_by(region, year) %>%
  mutate(sum_pop = sum(salary))
tb <- readfile("000000CG_3.csv") %>% 
  inner_join(tb, by = c("region", "year", "sex", "occuptional  (SSYK 2012)"))  
for (i in unique(tb$`occuptional  (SSYK 2012)`)){
  temp <- filter(tb, `occuptional  (SSYK 2012)` == i)
  if (dim(temp)[1] > 50){
    model <- lm(perc_women ~ log(salary.x) + year2.x + sex, data = temp)
    summary_table <- rbind (summary_table, mutate (mutate (tidy (summary (model)), ssyk = i)))
    anova_table <- rbind (anova_table, mutate (tidy (Anova (model, type = 2)), ssyk = i))
  }
}  
 
merge(summary_table, anova_table, by = "ssyk", all = TRUE) %>% 
  filter (term.y == "log(salary.x)") %>% 
  filter (term.x == "log(salary.x)") %>%
  ggplot () + 
    geom_point (mapping = aes(x = estimate, y = statistic.y)) +
    labs(
      x = "estimate",
      y = "F value for SSYK"
    )	
	
merge(summary_table, anova_table, by = "ssyk", all = TRUE) %>% 
  filter (term.y == "log(salary.x)") %>% 
  filter (term.x == "log(salary.x)") %>%
  select (ssyk, estimate, statistic.y) %>%
  arrange (desc (statistic.y)) %>%
  knitr::kable( 
  booktabs = TRUE,
  caption = 'Womens urbanization, comparison between the SSYK, Year 2014 - 2018') 	
```

## Salary correlation with population in region, comparison between the SSYK, Year 2003 - 2013
Average basic salary, monthly salary and women´s salary as a percentage of men´s salary by region, sector, occupational group (SSYK) and sex. Year 2003 - 2013
Number of employees
All sectors

Monthly salary
All sectors

```{r ssyk14-18_13, echo = TRUE, fig.cap = 'Salary correlation with population in region, comparison between the SSYK, Year 2003 - 2013, positive x = regions with higher population have higher salaries, negative x = regions with higher population have lower salaries'}	
tb <- readfile("AM0110A4_2.csv")

summary_table = 0
anova_table = 0
tb <- tb %>%
  group_by (`region`, year, `occupational group (SSYK)`) %>%
  mutate (perc_women = as.numeric (sub ("%", "", perc_women (salary)))) %>%
  group_by(region, year) %>%
  mutate(sum_pop = sum(salary))
tb <- readfile("AM0110A2_2.csv") %>% 
  inner_join(tb, by = c("region", "year", "sex", "occupational group (SSYK)"))  
for (i in unique(tb$`occupational group (SSYK)`)){
  temp <- filter(tb, `occupational group (SSYK)` == i)
  if (dim(temp)[1] > 50){
    model <- lm(log(salary.x) ~ sum_pop + year2.x + sex, data = temp)
    summary_table <- rbind (summary_table, mutate (mutate (tidy (summary (model)), ssyk = i)))
    anova_table <- rbind (anova_table, mutate (tidy (Anova (model, type = 2)), ssyk = i))
  }
}  
 
merge(summary_table, anova_table, by = "ssyk", all = TRUE) %>% 
  filter (term.y == "sum_pop") %>% 
  filter (term.x == "sum_pop") %>%
  ggplot () + 
    geom_point (mapping = aes(x = estimate, y = statistic.y)) +
    labs(
      x = "estimate",
      y = "F value for SSYK"
    )	
	
merge(summary_table, anova_table, by = "ssyk", all = TRUE) %>% 
  filter (term.y == "sum_pop") %>% 
  filter (term.x == "sum_pop") %>%
  select (ssyk, estimate, statistic.y) %>%
  arrange (desc (statistic.y)) %>%
  knitr::kable( 
  booktabs = TRUE,
  caption = 'Salary correlation with population in region, comparison between the SSYK, Year 2003 - 2013') 	
```

## Salary correlation with population in region, comparison between the SSYK, Year 2014 - 2018
Average basic salary, monthly salary and women´s salary as a percentage of men´s salary by region, sector, occupational group (SSYK 2012) and sex . Year 2014 - 2018
Number of employees
All sectors

Monthly salary
All sectors

```{r ssyk14-18_14, echo = TRUE, fig.cap = 'Salary correlation with population in region, comparison between the SSYK, Year 2014 - 2018, positive x = regions with higher population have higher salaries, negative x = regions with higher population have lower salaries'}	
tb <- readfile("000000CD_13.csv")

summary_table = 0
anova_table = 0
tb <- tb %>%
  group_by (`region`, year, `occuptional  (SSYK 2012)`) %>%
  mutate (perc_women = as.numeric (sub ("%", "", perc_women (salary)))) %>%
  group_by(region, year) %>%
  mutate(sum_pop = sum(salary))
tb <- readfile("000000CG_3.csv") %>% 
  inner_join(tb, by = c("region", "year", "sex", "occuptional  (SSYK 2012)"))  
for (i in unique(tb$`occuptional  (SSYK 2012)`)){
  temp <- filter(tb, `occuptional  (SSYK 2012)` == i)
  if (dim(temp)[1] > 50){
    model <- lm(log(salary.x) ~ sum_pop + year2.x + sex, data = temp)
    summary_table <- rbind (summary_table, mutate (mutate (tidy (summary (model)), ssyk = i)))
    anova_table <- rbind (anova_table, mutate (tidy (Anova (model, type = 2)), ssyk = i))
  }
}  
 
merge(summary_table, anova_table, by = "ssyk", all = TRUE) %>% 
  filter (term.y == "sum_pop") %>% 
  filter (term.x == "sum_pop") %>%
  ggplot () + 
    geom_point (mapping = aes(x = estimate, y = statistic.y)) +
    labs(
      x = "estimate",
      y = "F value for SSYK"
    )	
	
merge(summary_table, anova_table, by = "ssyk", all = TRUE) %>% 
  filter (term.y == "sum_pop") %>% 
  filter (term.x == "sum_pop") %>%
  select (ssyk, estimate, statistic.y) %>%
  arrange (desc (statistic.y)) %>%
  knitr::kable( 
  booktabs = TRUE,
  caption = 'Salary correlation with population in region, comparison between the SSYK, Year 2014 - 2018') 	
```

## Animations , SSYK 214, Architects, engineers and related professionals

Approximaton with B-spline  		
Average monthly pay (total pay), non-manual workers private sector (SLP),   
SEK by occuptional group (SSYK), age, sex and year 2000-2013   
214 Engineering professionals   
sex=total   

```{r ssyk_1, echo = TRUE, eval = FALSE}	 
readfile("AM0103A9.csv") %>% rowwise() %>% mutate(age2 = unlist(lapply(strsplit(substr(age, 1, 5), "-"), strtoi))[1]) %>%  
rowwise() %>% mutate(age3 = unlist(lapply(strsplit(substr(age, 1, 5), "-"), strtoi))[2]) %>%   
 ggplot(mapping = aes(x = year2 - (age2 + age3) / 2, y = salary)) +  
   geom_point() +   
   geom_smooth(method = lm, formula = y ~ splines::bs(x, 8), se = FALSE) +  
   transition_time(year2) +  
   labs(title = "Year: {frame_time}") +  
	scale_x_continuous(name = "Year of birth") +  
   scale_y_continuous(name = "Salary")  
anim_save("2000-2013.gif", width = 1000, height = 1000)	  
```	
![](https://mikaellundqvist.github.io/SCB-Engineers-Jonkoping/SCB-Engineers-Jonkoping_files/figure-html/2000-2013.gif) 
    
Average monthly pay (total pay), non-manual workers private sector (SLP),   
SEK by occuptional (SSYK 2012), age, sex and year 2014-2018  
214 Engineering professionals   
sex=total  

```{r ssyk_2, echo = TRUE, eval = FALSE}
readfile("00000031_2.csv") %>% rowwise() %>% mutate(age2 = unlist(lapply(strsplit(substr(age, 1, 5), "-"), strtoi))[1]) %>%  
rowwise() %>% mutate(age3 = unlist(lapply(strsplit(substr(age, 1, 5), "-"), strtoi))[2]) %>%   
 ggplot(mapping = aes(x = year2 - (age2 + age3) / 2, y = salary)) +  
   geom_point() +   
   geom_smooth(method = lm, formula = y ~ splines::bs(x, 8), se = FALSE) +  
   transition_time(year2) +  
   labs(title = "Year: {frame_time}") +  
	scale_x_continuous(name = "Year of birth") +  
   scale_y_continuous(name = "Salary")	  
anim_save("2014-2018.gif", width = 1000, height = 1000)    
``` 
![](https://mikaellundqvist.github.io/SCB-Engineers-Jonkoping/SCB-Engineers-Jonkoping_files/figure-html/2014-2018.gif)	
  
Average monthly pay (total pay), non-manual workers private sector (SLP),   
SEK by occuptional (SSYK 2012), age, sex and year 2000-2013  
214 Engineering professionals   
sex=total  
Growth of salaries by age group  

```{r ssyk_3, echo = TRUE, eval = FALSE}
csvfile <- readfile("AM0103A9.csv") %>%   
  rowwise() %>%   
  mutate(age2 = unlist(lapply(strsplit(substr(age, 1, 5), "-"), strtoi))[1]) %>%  
  rowwise() %>% mutate(age3 = unlist(lapply(strsplit(substr(age, 1, 5), "-"), strtoi))[2])	  
yearwise <- group_split(csvfile %>% group_by(year2))	  
ageGroupGrowth = data.frame()	  
for (i in 1:13){  
  temp <- cbind(year = 1999 + i, age = (yearwise[[i]]$age2 + yearwise[[i]]$age3) / 2, growth = yearwise[[i+1]]$relsalary / yearwise[[i]]$relsalary) - 1  
  ageGroupGrowth <- rbind(ageGroupGrowth, temp)  
}	  
ageGroupGrowth[, 'age'] <- factor(ageGroupGrowth[, 'age'])		  
ageGroupGrowth %>%	  
  ggplot(mapping = aes(x = age, y = growth)) +  
  geom_bar(stat = "identity") +  
  transition_time(as.numeric(year)) +  
  labs(title = "Year: {frame_time}") +  
  scale_x_discrete(name = "Age group") +  
  scale_y_continuous(name = "Salary increase (%)")	  
anim_save("AgeGroupGrowth2000-2013.gif", width = 1000, height = 1000)    
``` 
![](https://mikaellundqvist.github.io/SCB-Engineers-Jonkoping/SCB-Engineers-Jonkoping_files/figure-html/AgeGroupGrowth2000-2013.gif)	   
  
Average monthly pay (total pay), non-manual workers private sector (SLP),   
SEK by occuptional (SSYK 2012), age, sex and year 2000-2013  
214 Engineering professionals   
sex=total  
Individual salary increase by birthyear, estimated from B-spline approximation  

```{r ssyk_4, echo = TRUE, eval = FALSE}
csvfile <- readfile("AM0103A9.csv") %>%   
  rowwise() %>%   
  mutate(age2 = unlist(lapply(strsplit(substr(age, 1, 5), "-"), strtoi))[1]) %>%  
  rowwise() %>% mutate(age3 = unlist(lapply(strsplit(substr(age, 1, 5), "-"), strtoi))[2])  
indGrowth = data.frame()  
for (i in 2000:2012){  
  yearfile <- filter(csvfile, year2 == i)  
  x = yearfile$year2 - (yearfile$age2 + yearfile$age3) / 2  
  model = lm(yearfile$salary ~ splines::bs(x, 8))  
  X1 = data.frame(x = unlist(map2( i - 62, i - 22, seq)))  
  Y1 = predict(model, X1)   
  yearfile <- filter(csvfile, year2 == i + 1)  
  x = yearfile$year2 - (yearfile$age2 + yearfile$age3) / 2  
  model = lm(yearfile$salary ~ splines::bs(x, 8))  
  X2 = data.frame(x = unlist(map2( i + 1 - 62, i + 1 - 22, seq)))      
  Y2 = predict(model, X2)  
  growth = Y2[1:40] / Y1[2:41]    
  temp <- as_tibble(cbind(year = i+1, by=X2[1:40,1], growth=growth))  
  indGrowth <- rbind(indGrowth, temp)  
}   
indGrowth %>%	  
  ggplot(mapping = aes(x = by, y = growth)) +  
  geom_line() +  
 transition_time(year) +  
  labs(title = "Year: {frame_time}") +  
  scale_x_continuous(name = "Year of birth") +  
  scale_y_continuous(name = "Salary increase (%)")   
anim_save("indGrowth2000-2013.gif", width = 1000, height = 1000)  
```
![](https://mikaellundqvist.github.io/SCB-Engineers-Jonkoping/SCB-Engineers-Jonkoping_files/figure-html/indGrowth2000-2013.gif)  
  
Average monthly pay (total pay), non-manual workers private sector (SLP),   
SEK by occuptional (SSYK 2012), age, sex and year 2000-2013  
214 Engineering professionals   
sex=total  
Changes in the salary structure part by birthyear, salary structure part is   
defined as the derivative of the age / salary function, salary structure   
part defines how much the salaries needs to increase each year so that the  
structure remains unchanged.  

```{r ssyk_5, echo = TRUE, eval = FALSE}
csvfile <- readfile("AM0103A9.csv") %>%   
  rowwise() %>%   
  mutate(age2 = unlist(lapply(strsplit(substr(age, 1, 5), "-"), strtoi))[1]) %>%  
  rowwise() %>% mutate(age3 = unlist(lapply(strsplit(substr(age, 1, 5), "-"), strtoi))[2])    
salaryStructure = data.frame()  
for (i in min(csvfile$year2):max(csvfile$year2)){  
  yearfile <- filter(csvfile, year2 == i)  
  x = yearfile$year2 - (yearfile$age2 + yearfile$age3) / 2  
  model = lm(yearfile$salary ~ splines::bs(x, 8))  
  X = data.frame(x = unlist(map2( i - 62, i - 22, seq, length = 100)))  
  Y = predict(model, X)   
  dX = rowMeans(embed(X$x, 2))  
  dY = -diff(Y) / diff(X$x) / Y  
  temp <- as_tibble(cbind(year = i, dX = dX, dY = dY))  
  salaryStructure <- rbind(salaryStructure, temp)  
}   
salaryStructure %>%	  
  ggplot(mapping = aes(x = dX, y = dY)) +  
  geom_line() +  
  transition_time(year) +  
  labs(title = "Year: {frame_time}") +  
  scale_x_continuous(name = "Year of birth") +  
  scale_y_continuous(name = "Structural increase (%)")   
anim_save("salaryStructure2000-2013.gif", width = 1000, height = 1000)  
```
![](https://mikaellundqvist.github.io/SCB-Engineers-Jonkoping/SCB-Engineers-Jonkoping_files/figure-html/salaryStructure2000-2013.gif)