---
title: The number of engineers in the Swedish regions, feature importance
author: Mikael Lundqvist
date: '2020-05-04'
slug: the-number-of-engineers-in-the-swedish-regions-feature-importance
categories:
  - R
tags:
  - plot
  - R Markdown
  - regression
---



<p>In my last post, I analysed the feature importance for the per cent of engineers in Sweden who are women. I found that the size of the region is a feature that is significant for the per cent of engineers in Sweden who are women. The size of the region is correlated to the number of engineers that works in the region. In this post, I will analyse what predictors are best to forecast the number of engineers in the region. I will use models from the caret package in my analysis.</p>
<p>Statistics Sweden use NUTS (Nomenclature des Unités Territoriales Statistiques), which is the EU’s hierarchical regional division, to specify the regions.</p>
<p>Please send suggestions for improvement of the analysis to <a href="mailto:ranalystatisticssweden@gmail.com" class="email">ranalystatisticssweden@gmail.com</a>.</p>
<p>First, define libraries and functions.</p>
<pre class="r"><code>library (tidyverse)</code></pre>
<pre><code>## -- Attaching packages -------------------------------------------------- tidyverse 1.3.0 --</code></pre>
<pre><code>## v ggplot2 3.3.0     v purrr   0.3.4
## v tibble  3.0.0     v dplyr   0.8.5
## v tidyr   1.0.2     v stringr 1.4.0
## v readr   1.3.1     v forcats 0.5.0</code></pre>
<pre><code>## -- Conflicts ----------------------------------------------------- tidyverse_conflicts() --
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()</code></pre>
<pre class="r"><code>library (broom)
library (car)</code></pre>
<pre><code>## Loading required package: carData</code></pre>
<pre><code>## 
## Attaching package: &#39;car&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     recode</code></pre>
<pre><code>## The following object is masked from &#39;package:purrr&#39;:
## 
##     some</code></pre>
<pre class="r"><code>library (caret)    </code></pre>
<pre><code>## Loading required package: lattice</code></pre>
<pre><code>## 
## Attaching package: &#39;caret&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:purrr&#39;:
## 
##     lift</code></pre>
<pre class="r"><code>library (recipes)  </code></pre>
<pre><code>## 
## Attaching package: &#39;recipes&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:stringr&#39;:
## 
##     fixed</code></pre>
<pre><code>## The following object is masked from &#39;package:stats&#39;:
## 
##     step</code></pre>
<pre class="r"><code>library (PerformanceAnalytics)</code></pre>
<pre><code>## Loading required package: xts</code></pre>
<pre><code>## Loading required package: zoo</code></pre>
<pre><code>## 
## Attaching package: &#39;zoo&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     as.Date, as.Date.numeric</code></pre>
<pre><code>## 
## Attaching package: &#39;xts&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:dplyr&#39;:
## 
##     first, last</code></pre>
<pre><code>## 
## Attaching package: &#39;PerformanceAnalytics&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:graphics&#39;:
## 
##     legend</code></pre>
<pre class="r"><code>library (ggpubr)</code></pre>
<pre><code>## Loading required package: magrittr</code></pre>
<pre><code>## 
## Attaching package: &#39;magrittr&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:purrr&#39;:
## 
##     set_names</code></pre>
<pre><code>## The following object is masked from &#39;package:tidyr&#39;:
## 
##     extract</code></pre>
<pre class="r"><code>library (ipred) 
library (iml)
library (DALEX)</code></pre>
<pre><code>## Welcome to DALEX (version: 1.2.1).
## Find examples and detailed introduction at: https://pbiecek.github.io/ema/</code></pre>
<pre><code>## 
## Attaching package: &#39;DALEX&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     explain</code></pre>
<pre class="r"><code>library (Metrics)</code></pre>
<pre><code>## 
## Attaching package: &#39;Metrics&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:caret&#39;:
## 
##     precision, recall</code></pre>
<pre class="r"><code>library (auditor)</code></pre>
<pre><code>## 
## Attaching package: &#39;auditor&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:DALEX&#39;:
## 
##     model_performance</code></pre>
<pre class="r"><code>readfile &lt;- function (file1){read_csv (file1, col_types = cols(), locale = readr::locale (encoding = &quot;latin1&quot;), na = c(&quot;..&quot;, &quot;NA&quot;)) %&gt;%
  gather (starts_with(&quot;19&quot;), starts_with(&quot;20&quot;), key = &quot;year&quot;, value = groupsize) %&gt;%
  drop_na() %&gt;%
  mutate (year_n = parse_number (year))
}

perc_women &lt;- function(x){  
  ifelse (length(x) == 2, x[2] / (x[1] + x[2]), NA)
} 

nuts &lt;- read.csv(&quot;nuts.csv&quot;) %&gt;%
  mutate(NUTS2_sh = substr(NUTS2, 3, 4))

nuts %&gt;% 
  distinct (NUTS2_en) %&gt;%
  knitr::kable(
    booktabs = TRUE,
    caption = &#39;Nomenclature des Unités Territoriales Statistiques (NUTS)&#39;)</code></pre>
<table>
<caption><span id="tab:unnamed-chunk-1">Table 1: </span>Nomenclature des Unités Territoriales Statistiques (NUTS)</caption>
<thead>
<tr class="header">
<th align="left">NUTS2_en</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">SE11 Stockholm</td>
</tr>
<tr class="even">
<td align="left">SE12 East-Central Sweden</td>
</tr>
<tr class="odd">
<td align="left">SE21 Småland and islands</td>
</tr>
<tr class="even">
<td align="left">SE22 South Sweden</td>
</tr>
<tr class="odd">
<td align="left">SE23 West Sweden</td>
</tr>
<tr class="even">
<td align="left">SE31 North-Central Sweden</td>
</tr>
<tr class="odd">
<td align="left">SE32 Central Norrland</td>
</tr>
<tr class="even">
<td align="left">SE33 Upper Norrland</td>
</tr>
</tbody>
</table>
<pre class="r"><code>bs &lt;- function(formula, data, indices) {
  d &lt;- data[indices,] # allows boot to select sample 
  fit &lt;- lm(formula, weights = tbnum_weights, data=d)
  return(coef(fit)) 
} </code></pre>
<p>The data tables are downloaded from Statistics Sweden. They are saved as a comma-delimited file without heading, UF0506A1.csv, <a href="http://www.statistikdatabasen.scb.se/pxweb/en/ssd/" class="uri">http://www.statistikdatabasen.scb.se/pxweb/en/ssd/</a>.</p>
<p>The tables:</p>
<p>UF0506A1_1.csv: Population 16-74 years of age by region, highest level of education, age and sex. Year 1985 - 2018 NUTS 2 level 2008- 10 year intervals (16-74)</p>
<p>000000CG_1: Average basic salary, monthly salary and women´s salary as a percentage of men´s salary by region, sector, occupational group (SSYK 2012) and sex. Year 2014 - 2018 Monthly salary All sectors.</p>
<p>000000CD_1.csv: Average basic salary, monthly salary and women´s salary as a percentage of men´s salary by region, sector, occupational group (SSYK 2012) and sex. Year 2014 - 2018 Number of employees All sectors-</p>
<p>The data is aggregated, the size of each group is in the column groupsize.</p>
<p>I have also included some calculated predictors from the original data.</p>
<p>perc_women: The percentage of women within each group defined by edulevel, region and year</p>
<p>perc_women_region: The percentage of women within each group defined by year and region</p>
<p>regioneduyears: The average number of education years per capita within each group defined by year and region</p>
<p>eduquotient: The quotient between regioneduyears for men and women</p>
<p>salaryquotient: The quotient between salary for men and women within each group defined by year and region</p>
<p>perc_women_eng_region: The percentage of women who are engineers within each group defined by year and region</p>
<pre class="r"><code>numedulevel &lt;- read.csv(&quot;edulevel_1.csv&quot;) 

numedulevel[, 2] &lt;- data.frame(c(8, 9, 10, 12, 13, 15, 22, NA))

tb &lt;- readfile(&quot;000000CG_1.csv&quot;) 
tb &lt;- readfile(&quot;000000CD_1.csv&quot;) %&gt;% 
  left_join(tb, by = c(&quot;region&quot;, &quot;year&quot;, &quot;sex&quot;, &quot;sector&quot;,&quot;occuptional  (SSYK 2012)&quot;)) %&gt;%
  filter(`occuptional  (SSYK 2012)` == &quot;214 Engineering professionals&quot;) 

tb &lt;- readfile(&quot;UF0506A1_1.csv&quot;) %&gt;%  
  right_join(tb, by = c(&quot;region&quot;, &quot;year&quot;, &quot;sex&quot;)) %&gt;%
  right_join(numedulevel, by = c(&quot;level of education&quot; = &quot;level.of.education&quot;)) %&gt;%
  filter(!is.na(eduyears)) %&gt;%  
  mutate(edulevel = `level of education`) %&gt;%
  group_by(edulevel, region, year, sex) %&gt;%
  mutate(groupsize_all_ages = sum(groupsize)) %&gt;%  
  group_by(edulevel, region, year) %&gt;% 
  mutate (perc_women = perc_women (groupsize_all_ages[1:2])) %&gt;% 
  mutate (suming = sum(groupsize.x)) %&gt;%
  mutate (salary = (groupsize.y[2] * groupsize.x[2] + groupsize.y[1] * groupsize.x[1])/(groupsize.x[2] + groupsize.x[1])) %&gt;%
  group_by (sex, year, region) %&gt;%
  mutate(regioneduyears_sex = sum(groupsize * eduyears) / sum(groupsize)) %&gt;%
  mutate(regiongroupsize = sum(groupsize)) %&gt;% 
  mutate(suming_sex = groupsize.x) %&gt;%
  group_by(region, year) %&gt;%
  mutate (sum_pop = sum(groupsize)) %&gt;%
  mutate (regioneduyears = sum(groupsize * eduyears) / sum(groupsize)) %&gt;%
  mutate (perc_women_region = perc_women (regiongroupsize[1:2])) %&gt;% 
  mutate (eduquotient = regioneduyears_sex[2] / regioneduyears_sex[1]) %&gt;% 
  mutate (salary_sex = groupsize.y) %&gt;%
  mutate (salaryquotient = salary_sex[2] / salary_sex[1]) %&gt;%   
  mutate (perc_women_eng_region = perc_women(suming_sex[1:2])) %&gt;%  
  left_join(nuts %&gt;% distinct (NUTS2_en, NUTS2_sh), by = c(&quot;region&quot; = &quot;NUTS2_en&quot;)) %&gt;%
  drop_na()

summary(tb)</code></pre>
<pre><code>##     region              age            level of education     sex           
##  Length:532         Length:532         Length:532         Length:532        
##  Class :character   Class :character   Class :character   Class :character  
##  Mode  :character   Mode  :character   Mode  :character   Mode  :character  
##                                                                             
##                                                                             
##                                                                             
##      year             groupsize          year_n        sector         
##  Length:532         Min.   :   405   Min.   :2014   Length:532        
##  Class :character   1st Qu.: 20996   1st Qu.:2015   Class :character  
##  Mode  :character   Median : 43656   Median :2016   Mode  :character  
##                     Mean   : 64760   Mean   :2016                     
##                     3rd Qu.:102394   3rd Qu.:2017                     
##                     Max.   :271889   Max.   :2018                     
##  occuptional  (SSYK 2012)  groupsize.x       year_n.x     groupsize.y   
##  Length:532               Min.   :  340   Min.   :2014   Min.   :34700  
##  Class :character         1st Qu.: 1700   1st Qu.:2015   1st Qu.:40300  
##  Mode  :character         Median : 3000   Median :2016   Median :42000  
##                           Mean   : 5850   Mean   :2016   Mean   :42078  
##                           3rd Qu.: 7475   3rd Qu.:2017   3rd Qu.:43925  
##                           Max.   :21400   Max.   :2018   Max.   :49400  
##     year_n.y       eduyears       edulevel         groupsize_all_ages
##  Min.   :2014   Min.   : 8.00   Length:532         Min.   :   405    
##  1st Qu.:2015   1st Qu.: 9.00   Class :character   1st Qu.: 20996    
##  Median :2016   Median :12.00   Mode  :character   Median : 43656    
##  Mean   :2016   Mean   :12.71                      Mean   : 64760    
##  3rd Qu.:2017   3rd Qu.:15.00                      3rd Qu.:102394    
##  Max.   :2018   Max.   :22.00                      Max.   :271889    
##    perc_women         suming          salary      regioneduyears_sex
##  Min.   :0.3575   Min.   : 2040   Min.   :38376   Min.   :11.18     
##  1st Qu.:0.4338   1st Qu.: 3080   1st Qu.:40916   1st Qu.:11.61     
##  Median :0.4631   Median : 8950   Median :42866   Median :11.74     
##  Mean   :0.4771   Mean   :11701   Mean   :42776   Mean   :11.79     
##  3rd Qu.:0.5132   3rd Qu.:20100   3rd Qu.:44444   3rd Qu.:12.04     
##  Max.   :0.6423   Max.   :29500   Max.   :48429   Max.   :12.55     
##  regiongroupsize    suming_sex       sum_pop        regioneduyears 
##  Min.   :128262   Min.   :  340   Min.   : 262870   Min.   :11.39  
##  1st Qu.:288058   1st Qu.: 1700   1st Qu.: 587142   1st Qu.:11.54  
##  Median :514608   Median : 3000   Median :1029820   Median :11.81  
##  Mean   :453318   Mean   : 5850   Mean   : 906635   Mean   :11.79  
##  3rd Qu.:691870   3rd Qu.: 7475   3rd Qu.:1395157   3rd Qu.:11.90  
##  Max.   :827940   Max.   :21400   Max.   :1655215   Max.   :12.41  
##  perc_women_region  eduquotient      salary_sex    salaryquotient  
##  Min.   :0.4831    Min.   :1.019   Min.   :34700   Min.   :0.8653  
##  1st Qu.:0.4882    1st Qu.:1.029   1st Qu.:40300   1st Qu.:0.9329  
##  Median :0.4934    Median :1.034   Median :42000   Median :0.9395  
##  Mean   :0.4923    Mean   :1.034   Mean   :42078   Mean   :0.9447  
##  3rd Qu.:0.4970    3rd Qu.:1.041   3rd Qu.:43925   3rd Qu.:0.9537  
##  Max.   :0.5014    Max.   :1.047   Max.   :49400   Max.   :1.0446  
##  perc_women_eng_region   NUTS2_sh        
##  Min.   :0.1566        Length:532        
##  1st Qu.:0.1787        Class :character  
##  Median :0.2042        Mode  :character  
##  Mean   :0.2039                          
##  3rd Qu.:0.2216                          
##  Max.   :0.2746</code></pre>
<p>Prepare the data using Tidyverse recipes package, i.e. centre, scale and make sure all predictors are numerical.</p>
<pre class="r"><code>tbtemp &lt;- ungroup(tb) %&gt;% dplyr::select(region, salary, year_n, sum_pop, regioneduyears, suming, perc_women_region, salaryquotient, eduquotient, perc_women_eng_region)

tb_outliers_info &lt;- unique(tbtemp)

tb_unique &lt;- unique(dplyr::select(tbtemp, -region))

tbnum_weights &lt;- tb_unique$suming

blueprint &lt;- recipe(suming ~ ., data = tb_unique) %&gt;%
  step_integer(matches(&quot;Qual|Cond|QC|Qu&quot;)) %&gt;%
  step_center(all_numeric(), -all_outcomes()) %&gt;%
  step_scale(all_numeric(), -all_outcomes()) %&gt;%
  step_dummy(all_nominal(), -all_outcomes(), one_hot = TRUE)

prepare &lt;- prep(blueprint, training = tb_unique)

tbnum &lt;- bake(prepare, new_data = tb_unique)</code></pre>
<p>The correlation chart shows that many predictors are correlated with the response variable but also that many predictors are correlated between each other. Some notable correlations are in a dedicated plot below.</p>
<pre class="r"><code>chart.Correlation(tbnum, histogram = TRUE, pch = 19)</code></pre>
<div class="figure"><span id="fig:unnamed-chunk-41"></span>
<img src="/post/2020-05-04-the-number-of-engineers-in-the-swedish-regions-feature-importance_files/figure-html/unnamed-chunk-4-1.png" alt="Correlation between response and predictors and between predictors, Year 2014 - 2018" width="672" />
<p class="caption">
Figure 1: Correlation between response and predictors and between predictors, Year 2014 - 2018
</p>
</div>
<pre class="r"><code>p1 &lt;- tb %&gt;%
  ggscatter(x = &quot;sum_pop&quot;, y = &quot;suming&quot;, 
    add = &quot;reg.line&quot;, conf.int = TRUE, 
    cor.coef = TRUE, cor.method = &quot;pearson&quot;) 

p2 &lt;- tb %&gt;%
  ggscatter(x = &quot;sum_pop&quot;, y = &quot;perc_women_region&quot;, 
    add = &quot;reg.line&quot;, conf.int = TRUE, 
    cor.coef = TRUE, cor.method = &quot;pearson&quot;) 

p3 &lt;- tb %&gt;%
  ggscatter(x = &quot;suming&quot;, y = &quot;perc_women_eng_region&quot;, 
    add = &quot;reg.line&quot;, conf.int = TRUE, 
    cor.coef = TRUE, cor.method = &quot;pearson&quot;)

p4 &lt;- tb %&gt;%
  ggscatter(x = &quot;sum_pop&quot;, y = &quot;perc_women_eng_region&quot;, 
    add = &quot;reg.line&quot;, conf.int = TRUE, 
    cor.coef = TRUE, cor.method = &quot;pearson&quot;)

gridExtra::grid.arrange(p1, p2, p3, p4, ncol = 2)</code></pre>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;
## `geom_smooth()` using formula &#39;y ~ x&#39;
## `geom_smooth()` using formula &#39;y ~ x&#39;
## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<div class="figure"><span id="fig:unnamed-chunk-42"></span>
<img src="/post/2020-05-04-the-number-of-engineers-in-the-swedish-regions-feature-importance_files/figure-html/unnamed-chunk-4-2.png" alt="Correlation between response and predictors and between predictors, Year 2014 - 2018" width="672" />
<p class="caption">
Figure 2: Correlation between response and predictors and between predictors, Year 2014 - 2018
</p>
</div>
<p>plot_model will show diagnostics for the model, a residual plot, scale location plot, residual density and the regression error characteristic curve. It will also show the residuals versus the actual response to help find outliers. It will plot the feature importance and feature effects. In addition, it will plot how strongly features interact with each other and the 2-way interactions between the feature with the strongest interaction and all other features. The interaction measure regards how much of the variance of f(x) is explained by the interaction. The measure is between 0 (no interaction) and 1 (= 100% of variance of f(x) due to interactions).</p>
<pre class="r"><code>plot_model &lt;- function(model){
   invisible(capture.output(exp_model &lt;- DALEX::explain(model, data = tbnum, y = tbnum$suming))) # Knit and DALEX::explain generates invalid rss feed
  
   lm_mr &lt;- model_residual(exp_model)  
    
   predictor &lt;- Predictor$new(model, 
      data = dplyr::select(tbnum, -suming), 
      y = tbnum$suming)    
   
   writeLines(&quot;&quot;)
   
   print(model)
   
   print(postResample(pred = predict(model), obs = tbnum$suming))
 
   p1 &lt;- plot(lm_mr, type = &quot;residual&quot;)  
   
   p2 &lt;- plot(lm_mr, type = &quot;scalelocation&quot;)   
   
   p3 &lt;- plot(lm_mr, type = &quot;residual_density&quot;) 
   
   p4 &lt;- plot(lm_mr, type = &quot;rec&quot;) 
   
   print(gridExtra::grid.arrange(p1, p2, p3, p4, ncol = 2))
   
   print(plot_residual(lm_mr, variable = &quot;_y_hat_&quot;, nlabel = 10))
   
   print(plot (FeatureImp$new(predictor, loss = &quot;mae&quot;)))

   print(plot (FeatureEffects$new(predictor)))
   
   interact &lt;- Interaction$new(predictor)
   
   p1 &lt;- plot (interact)
   
   p2 &lt;- plot (Interaction$new(predictor, feature = as.character(arrange(interact$results, desc(.interaction))[1,1])))
   
   print(gridExtra::grid.arrange(p1, p2, ncol = 2))
}</code></pre>
<p>Fit the following models and plot inference and diagnostics. Principal component analysis (PCA) is used to transform the data into a smaller subspace where the new variables are uncorrelated with one another due to the high multicollinearity.
Linear Regression, Projection Pursuit Regression, Bagged MARS, Random Forest, Bagged CART, Boosted Tree, Conditional Inference Tree</p>
<pre class="r"><code>modelcollection &lt;- c(&quot;lm&quot;, &quot;ppr&quot;, &quot;bagEarth&quot;, &quot;ranger&quot;, &quot;treebag&quot;, &quot;blackboost&quot;, &quot;ctree&quot;)

for (model in modelcollection){
  invisible(capture.output(model &lt;- caret::train(
     suming ~ .,
     data = tbnum,
     method = model,
     preProc=c(&quot;pca&quot;),
     weights = tbnum_weights,
     trControl = trainControl(method = &quot;cv&quot;, number = 10)
  )))  

  plot_model(model)
}</code></pre>
<pre><code>## 
## Linear Regression 
## 
## 38 samples
##  8 predictor
## 
## Pre-processing: principal component signal extraction (8), centered (8),
##  scaled (8) 
## Resampling: Cross-Validated (10 fold) 
## Summary of sample sizes: 35, 34, 34, 35, 34, 34, ... 
## Resampling results:
## 
##   RMSE      Rsquared   MAE    
##   4237.874  0.8822043  3423.46
## 
## Tuning parameter &#39;intercept&#39; was held constant at a value of TRUE
##         RMSE     Rsquared          MAE 
## 3883.8558386    0.8463367 2767.1742230</code></pre>
<div class="figure"><span id="fig:unnamed-chunk-61"></span>
<img src="/post/2020-05-04-the-number-of-engineers-in-the-swedish-regions-feature-importance_files/figure-html/unnamed-chunk-6-1.png" alt=", Year 2014 - 2018" width="672" />
<p class="caption">
Figure 3: , Year 2014 - 2018
</p>
</div>
<pre><code>## TableGrob (2 x 2) &quot;arrange&quot;: 4 grobs
##   z     cells    name           grob
## 1 1 (1-1,1-1) arrange gtable[layout]
## 2 2 (1-1,2-2) arrange gtable[layout]
## 3 3 (2-2,1-1) arrange gtable[layout]
## 4 4 (2-2,2-2) arrange gtable[layout]</code></pre>
<div class="figure"><span id="fig:unnamed-chunk-62"></span>
<img src="/post/2020-05-04-the-number-of-engineers-in-the-swedish-regions-feature-importance_files/figure-html/unnamed-chunk-6-2.png" alt=", Year 2014 - 2018" width="672" />
<p class="caption">
Figure 4: , Year 2014 - 2018
</p>
</div>
<div class="figure"><span id="fig:unnamed-chunk-63"></span>
<img src="/post/2020-05-04-the-number-of-engineers-in-the-swedish-regions-feature-importance_files/figure-html/unnamed-chunk-6-3.png" alt=", Year 2014 - 2018" width="672" />
<p class="caption">
Figure 5: , Year 2014 - 2018
</p>
</div>
<pre><code>## 
## Attaching package: &#39;patchwork&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:MASS&#39;:
## 
##     area</code></pre>
<div class="figure"><span id="fig:unnamed-chunk-64"></span>
<img src="/post/2020-05-04-the-number-of-engineers-in-the-swedish-regions-feature-importance_files/figure-html/unnamed-chunk-6-4.png" alt=", Year 2014 - 2018" width="672" />
<p class="caption">
Figure 6: , Year 2014 - 2018
</p>
</div>
<div class="figure"><span id="fig:unnamed-chunk-65"></span>
<img src="/post/2020-05-04-the-number-of-engineers-in-the-swedish-regions-feature-importance_files/figure-html/unnamed-chunk-6-5.png" alt=", Year 2014 - 2018" width="672" />
<p class="caption">
Figure 7: , Year 2014 - 2018
</p>
</div>
<pre><code>## TableGrob (1 x 2) &quot;arrange&quot;: 2 grobs
##   z     cells    name           grob
## 1 1 (1-1,1-1) arrange gtable[layout]
## 2 2 (1-1,2-2) arrange gtable[layout]
## 
## Projection Pursuit Regression 
## 
## 38 samples
##  8 predictor
## 
## Pre-processing: principal component signal extraction (8), centered (8),
##  scaled (8) 
## Resampling: Cross-Validated (10 fold) 
## Summary of sample sizes: 34, 34, 34, 34, 34, 34, ... 
## Resampling results across tuning parameters:
## 
##   nterms  RMSE      Rsquared   MAE     
##   1       4130.062  0.8121472  3256.277
##   2       4246.374  0.8418553  3408.002
##   3       3906.203  0.8768507  3171.871
## 
## RMSE was used to select the optimal model using the smallest value.
## The final value used for the model was nterms = 3.
##         RMSE     Rsquared          MAE 
## 1402.1162486    0.9796416 1090.5426055</code></pre>
<div class="figure"><span id="fig:unnamed-chunk-66"></span>
<img src="/post/2020-05-04-the-number-of-engineers-in-the-swedish-regions-feature-importance_files/figure-html/unnamed-chunk-6-6.png" alt=", Year 2014 - 2018" width="672" />
<p class="caption">
Figure 8: , Year 2014 - 2018
</p>
</div>
<pre><code>## TableGrob (2 x 2) &quot;arrange&quot;: 4 grobs
##   z     cells    name           grob
## 1 1 (1-1,1-1) arrange gtable[layout]
## 2 2 (1-1,2-2) arrange gtable[layout]
## 3 3 (2-2,1-1) arrange gtable[layout]
## 4 4 (2-2,2-2) arrange gtable[layout]</code></pre>
<div class="figure"><span id="fig:unnamed-chunk-67"></span>
<img src="/post/2020-05-04-the-number-of-engineers-in-the-swedish-regions-feature-importance_files/figure-html/unnamed-chunk-6-7.png" alt=", Year 2014 - 2018" width="672" />
<p class="caption">
Figure 9: , Year 2014 - 2018
</p>
</div>
<div class="figure"><span id="fig:unnamed-chunk-68"></span>
<img src="/post/2020-05-04-the-number-of-engineers-in-the-swedish-regions-feature-importance_files/figure-html/unnamed-chunk-6-8.png" alt=", Year 2014 - 2018" width="672" />
<p class="caption">
Figure 10: , Year 2014 - 2018
</p>
</div>
<div class="figure"><span id="fig:unnamed-chunk-69"></span>
<img src="/post/2020-05-04-the-number-of-engineers-in-the-swedish-regions-feature-importance_files/figure-html/unnamed-chunk-6-9.png" alt=", Year 2014 - 2018" width="672" />
<p class="caption">
Figure 11: , Year 2014 - 2018
</p>
</div>
<pre><code>## TableGrob (1 x 2) &quot;arrange&quot;: 2 grobs
##   z     cells    name           grob
## 1 1 (1-1,1-1) arrange gtable[layout]
## 2 2 (1-1,2-2) arrange gtable[layout]</code></pre>
<pre><code>## Loading required package: earth</code></pre>
<pre><code>## Loading required package: Formula</code></pre>
<pre><code>## Loading required package: plotmo</code></pre>
<pre><code>## Loading required package: plotrix</code></pre>
<pre><code>## 
## Attaching package: &#39;plotrix&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:scales&#39;:
## 
##     rescale</code></pre>
<pre><code>## Loading required package: TeachingDemos</code></pre>
<div class="figure"><span id="fig:unnamed-chunk-610"></span>
<img src="/post/2020-05-04-the-number-of-engineers-in-the-swedish-regions-feature-importance_files/figure-html/unnamed-chunk-6-10.png" alt=", Year 2014 - 2018" width="672" />
<p class="caption">
Figure 12: , Year 2014 - 2018
</p>
</div>
<pre><code>## 
## Bagged MARS 
## 
## 38 samples
##  8 predictor
## 
## Pre-processing: principal component signal extraction (8), centered (8),
##  scaled (8) 
## Resampling: Cross-Validated (10 fold) 
## Summary of sample sizes: 34, 34, 34, 34, 35, 34, ... 
## Resampling results across tuning parameters:
## 
##   nprune  RMSE      Rsquared   MAE     
##    2      4671.353  0.8678650  3762.492
##    7      4301.170  0.8466750  3379.813
##   13      4535.948  0.8434574  3713.592
## 
## Tuning parameter &#39;degree&#39; was held constant at a value of 1
## RMSE was used to select the optimal model using the smallest value.
## The final values used for the model were nprune = 7 and degree = 1.
##         RMSE     Rsquared          MAE 
## 2950.1269148    0.9075753 2178.7339222</code></pre>
<div class="figure"><span id="fig:unnamed-chunk-611"></span>
<img src="/post/2020-05-04-the-number-of-engineers-in-the-swedish-regions-feature-importance_files/figure-html/unnamed-chunk-6-11.png" alt=", Year 2014 - 2018" width="672" />
<p class="caption">
Figure 13: , Year 2014 - 2018
</p>
</div>
<pre><code>## TableGrob (2 x 2) &quot;arrange&quot;: 4 grobs
##   z     cells    name           grob
## 1 1 (1-1,1-1) arrange gtable[layout]
## 2 2 (1-1,2-2) arrange gtable[layout]
## 3 3 (2-2,1-1) arrange gtable[layout]
## 4 4 (2-2,2-2) arrange gtable[layout]</code></pre>
<div class="figure"><span id="fig:unnamed-chunk-612"></span>
<img src="/post/2020-05-04-the-number-of-engineers-in-the-swedish-regions-feature-importance_files/figure-html/unnamed-chunk-6-12.png" alt=", Year 2014 - 2018" width="672" />
<p class="caption">
Figure 14: , Year 2014 - 2018
</p>
</div>
<div class="figure"><span id="fig:unnamed-chunk-613"></span>
<img src="/post/2020-05-04-the-number-of-engineers-in-the-swedish-regions-feature-importance_files/figure-html/unnamed-chunk-6-13.png" alt=", Year 2014 - 2018" width="672" />
<p class="caption">
Figure 15: , Year 2014 - 2018
</p>
</div>
<div class="figure"><span id="fig:unnamed-chunk-614"></span>
<img src="/post/2020-05-04-the-number-of-engineers-in-the-swedish-regions-feature-importance_files/figure-html/unnamed-chunk-6-14.png" alt=", Year 2014 - 2018" width="672" />
<p class="caption">
Figure 16: , Year 2014 - 2018
</p>
</div>
<div class="figure"><span id="fig:unnamed-chunk-615"></span>
<img src="/post/2020-05-04-the-number-of-engineers-in-the-swedish-regions-feature-importance_files/figure-html/unnamed-chunk-6-15.png" alt=", Year 2014 - 2018" width="672" />
<p class="caption">
Figure 17: , Year 2014 - 2018
</p>
</div>
<pre><code>## TableGrob (1 x 2) &quot;arrange&quot;: 2 grobs
##   z     cells    name           grob
## 1 1 (1-1,1-1) arrange gtable[layout]
## 2 2 (1-1,2-2) arrange gtable[layout]
## 
## Random Forest 
## 
## 38 samples
##  8 predictor
## 
## Pre-processing: principal component signal extraction (8), centered (8),
##  scaled (8) 
## Resampling: Cross-Validated (10 fold) 
## Summary of sample sizes: 34, 34, 34, 34, 34, 34, ... 
## Resampling results across tuning parameters:
## 
##   mtry  splitrule   RMSE      Rsquared   MAE     
##   2     variance    6106.457  0.7899054  5600.253
##   2     extratrees  5899.990  0.8178129  5413.206
##   3     variance    5242.999  0.8372295  4583.812
##   3     extratrees  4978.308  0.8145967  4339.194
##   4     variance    4367.341  0.8690214  3526.925
##   4     extratrees  4461.317  0.8391514  3797.024
## 
## Tuning parameter &#39;min.node.size&#39; was held constant at a value of 5
## RMSE was used to select the optimal model using the smallest value.
## The final values used for the model were mtry = 4, splitrule = variance
##  and min.node.size = 5.
##         RMSE     Rsquared          MAE 
## 1782.3243833    0.9749664 1275.2575351</code></pre>
<div class="figure"><span id="fig:unnamed-chunk-616"></span>
<img src="/post/2020-05-04-the-number-of-engineers-in-the-swedish-regions-feature-importance_files/figure-html/unnamed-chunk-6-16.png" alt=", Year 2014 - 2018" width="672" />
<p class="caption">
Figure 18: , Year 2014 - 2018
</p>
</div>
<pre><code>## TableGrob (2 x 2) &quot;arrange&quot;: 4 grobs
##   z     cells    name           grob
## 1 1 (1-1,1-1) arrange gtable[layout]
## 2 2 (1-1,2-2) arrange gtable[layout]
## 3 3 (2-2,1-1) arrange gtable[layout]
## 4 4 (2-2,2-2) arrange gtable[layout]</code></pre>
<div class="figure"><span id="fig:unnamed-chunk-617"></span>
<img src="/post/2020-05-04-the-number-of-engineers-in-the-swedish-regions-feature-importance_files/figure-html/unnamed-chunk-6-17.png" alt=", Year 2014 - 2018" width="672" />
<p class="caption">
Figure 19: , Year 2014 - 2018
</p>
</div>
<div class="figure"><span id="fig:unnamed-chunk-618"></span>
<img src="/post/2020-05-04-the-number-of-engineers-in-the-swedish-regions-feature-importance_files/figure-html/unnamed-chunk-6-18.png" alt=", Year 2014 - 2018" width="672" />
<p class="caption">
Figure 20: , Year 2014 - 2018
</p>
</div>
<div class="figure"><span id="fig:unnamed-chunk-619"></span>
<img src="/post/2020-05-04-the-number-of-engineers-in-the-swedish-regions-feature-importance_files/figure-html/unnamed-chunk-6-19.png" alt=", Year 2014 - 2018" width="672" />
<p class="caption">
Figure 21: , Year 2014 - 2018
</p>
</div>
<div class="figure"><span id="fig:unnamed-chunk-620"></span>
<img src="/post/2020-05-04-the-number-of-engineers-in-the-swedish-regions-feature-importance_files/figure-html/unnamed-chunk-6-20.png" alt=", Year 2014 - 2018" width="672" />
<p class="caption">
Figure 22: , Year 2014 - 2018
</p>
</div>
<pre><code>## TableGrob (1 x 2) &quot;arrange&quot;: 2 grobs
##   z     cells    name           grob
## 1 1 (1-1,1-1) arrange gtable[layout]
## 2 2 (1-1,2-2) arrange gtable[layout]
## 
## Bagged CART 
## 
## 38 samples
##  8 predictor
## 
## Pre-processing: principal component signal extraction (8), centered (8),
##  scaled (8) 
## Resampling: Cross-Validated (10 fold) 
## Summary of sample sizes: 35, 34, 34, 34, 34, 34, ... 
## Resampling results:
## 
##   RMSE      Rsquared   MAE     
##   4828.894  0.8094027  3527.702
## 
##         RMSE     Rsquared          MAE 
## 3481.9118680    0.8750994 2582.9979981</code></pre>
<div class="figure"><span id="fig:unnamed-chunk-621"></span>
<img src="/post/2020-05-04-the-number-of-engineers-in-the-swedish-regions-feature-importance_files/figure-html/unnamed-chunk-6-21.png" alt=", Year 2014 - 2018" width="672" />
<p class="caption">
Figure 23: , Year 2014 - 2018
</p>
</div>
<pre><code>## TableGrob (2 x 2) &quot;arrange&quot;: 4 grobs
##   z     cells    name           grob
## 1 1 (1-1,1-1) arrange gtable[layout]
## 2 2 (1-1,2-2) arrange gtable[layout]
## 3 3 (2-2,1-1) arrange gtable[layout]
## 4 4 (2-2,2-2) arrange gtable[layout]</code></pre>
<div class="figure"><span id="fig:unnamed-chunk-622"></span>
<img src="/post/2020-05-04-the-number-of-engineers-in-the-swedish-regions-feature-importance_files/figure-html/unnamed-chunk-6-22.png" alt=", Year 2014 - 2018" width="672" />
<p class="caption">
Figure 24: , Year 2014 - 2018
</p>
</div>
<div class="figure"><span id="fig:unnamed-chunk-623"></span>
<img src="/post/2020-05-04-the-number-of-engineers-in-the-swedish-regions-feature-importance_files/figure-html/unnamed-chunk-6-23.png" alt=", Year 2014 - 2018" width="672" />
<p class="caption">
Figure 25: , Year 2014 - 2018
</p>
</div>
<div class="figure"><span id="fig:unnamed-chunk-624"></span>
<img src="/post/2020-05-04-the-number-of-engineers-in-the-swedish-regions-feature-importance_files/figure-html/unnamed-chunk-6-24.png" alt=", Year 2014 - 2018" width="672" />
<p class="caption">
Figure 26: , Year 2014 - 2018
</p>
</div>
<pre><code>## TableGrob (1 x 2) &quot;arrange&quot;: 2 grobs
##   z     cells    name           grob
## 1 1 (1-1,1-1) arrange gtable[layout]
## 2 2 (1-1,2-2) arrange gtable[layout]</code></pre>
<pre><code>## Warning in if (class(response) == &quot;data.frame&quot;) response &lt;- as.matrix(response):
## the condition has length &gt; 1 and only the first element will be used

## Warning in if (class(response) == &quot;data.frame&quot;) response &lt;- as.matrix(response):
## the condition has length &gt; 1 and only the first element will be used</code></pre>
<div class="figure"><span id="fig:unnamed-chunk-625"></span>
<img src="/post/2020-05-04-the-number-of-engineers-in-the-swedish-regions-feature-importance_files/figure-html/unnamed-chunk-6-25.png" alt=", Year 2014 - 2018" width="672" />
<p class="caption">
Figure 27: , Year 2014 - 2018
</p>
</div>
<pre><code>## 
## Boosted Tree 
## 
## 38 samples
##  8 predictor
## 
## Pre-processing: principal component signal extraction (8), centered (8),
##  scaled (8) 
## Resampling: Cross-Validated (10 fold) 
## Summary of sample sizes: 34, 34, 34, 34, 34, 35, ... 
## Resampling results across tuning parameters:
## 
##   maxdepth  mstop  RMSE      Rsquared   MAE     
##   1          50    4440.664  0.7708467  3558.175
##   1         100    4429.005  0.7943325  3512.541
##   1         150    4456.381  0.7981314  3487.719
##   2          50    4598.712  0.8028983  3497.232
##   2         100    4582.388  0.7786909  3482.167
##   2         150    4546.031  0.7990669  3437.192
##   3          50    4166.522  0.8926944  2940.884
##   3         100    4134.064  0.8935203  2910.923
##   3         150    4139.154  0.8939033  2918.382
## 
## RMSE was used to select the optimal model using the smallest value.
## The final values used for the model were mstop = 100 and maxdepth = 3.
##        RMSE    Rsquared         MAE 
## 110.7432126   0.9998769  88.9875261</code></pre>
<div class="figure"><span id="fig:unnamed-chunk-626"></span>
<img src="/post/2020-05-04-the-number-of-engineers-in-the-swedish-regions-feature-importance_files/figure-html/unnamed-chunk-6-26.png" alt=", Year 2014 - 2018" width="672" />
<p class="caption">
Figure 28: , Year 2014 - 2018
</p>
</div>
<pre><code>## TableGrob (2 x 2) &quot;arrange&quot;: 4 grobs
##   z     cells    name           grob
## 1 1 (1-1,1-1) arrange gtable[layout]
## 2 2 (1-1,2-2) arrange gtable[layout]
## 3 3 (2-2,1-1) arrange gtable[layout]
## 4 4 (2-2,2-2) arrange gtable[layout]</code></pre>
<div class="figure"><span id="fig:unnamed-chunk-627"></span>
<img src="/post/2020-05-04-the-number-of-engineers-in-the-swedish-regions-feature-importance_files/figure-html/unnamed-chunk-6-27.png" alt=", Year 2014 - 2018" width="672" />
<p class="caption">
Figure 29: , Year 2014 - 2018
</p>
</div>
<div class="figure"><span id="fig:unnamed-chunk-628"></span>
<img src="/post/2020-05-04-the-number-of-engineers-in-the-swedish-regions-feature-importance_files/figure-html/unnamed-chunk-6-28.png" alt=", Year 2014 - 2018" width="672" />
<p class="caption">
Figure 30: , Year 2014 - 2018
</p>
</div>
<div class="figure"><span id="fig:unnamed-chunk-629"></span>
<img src="/post/2020-05-04-the-number-of-engineers-in-the-swedish-regions-feature-importance_files/figure-html/unnamed-chunk-6-29.png" alt=", Year 2014 - 2018" width="672" />
<p class="caption">
Figure 31: , Year 2014 - 2018
</p>
</div>
<div class="figure"><span id="fig:unnamed-chunk-630"></span>
<img src="/post/2020-05-04-the-number-of-engineers-in-the-swedish-regions-feature-importance_files/figure-html/unnamed-chunk-6-30.png" alt=", Year 2014 - 2018" width="672" />
<p class="caption">
Figure 32: , Year 2014 - 2018
</p>
</div>
<pre><code>## TableGrob (1 x 2) &quot;arrange&quot;: 2 grobs
##   z     cells    name           grob
## 1 1 (1-1,1-1) arrange gtable[layout]
## 2 2 (1-1,2-2) arrange gtable[layout]
## 
## Conditional Inference Tree 
## 
## 38 samples
##  8 predictor
## 
## Pre-processing: principal component signal extraction (8), centered (8),
##  scaled (8) 
## Resampling: Cross-Validated (10 fold) 
## Summary of sample sizes: 34, 34, 35, 34, 34, 34, ... 
## Resampling results across tuning parameters:
## 
##   mincriterion  RMSE      Rsquared   MAE   
##   0.01          4244.251  0.7539372  2824.5
##   0.50          4244.251  0.7539372  2824.5
##   0.99          4244.251  0.7539372  2824.5
## 
## RMSE was used to select the optimal model using the smallest value.
## The final value used for the model was mincriterion = 0.99.
##     RMSE Rsquared      MAE 
##        0        1        0</code></pre>
<pre><code>## Warning: Removed 38 rows containing missing values (geom_point).</code></pre>
<div class="figure"><span id="fig:unnamed-chunk-631"></span>
<img src="/post/2020-05-04-the-number-of-engineers-in-the-swedish-regions-feature-importance_files/figure-html/unnamed-chunk-6-31.png" alt=", Year 2014 - 2018" width="672" />
<p class="caption">
Figure 33: , Year 2014 - 2018
</p>
</div>
<pre><code>## TableGrob (2 x 2) &quot;arrange&quot;: 4 grobs
##   z     cells    name           grob
## 1 1 (1-1,1-1) arrange gtable[layout]
## 2 2 (1-1,2-2) arrange gtable[layout]
## 3 3 (2-2,1-1) arrange gtable[layout]
## 4 4 (2-2,2-2) arrange gtable[layout]</code></pre>
<pre><code>## Warning in .subset2(public_bind_env, &quot;initialize&quot;)(...): Model error is 0,
## switching from compare=&#39;ratio&#39; to compare=&#39;difference&#39;</code></pre>
<div class="figure"><span id="fig:unnamed-chunk-632"></span>
<img src="/post/2020-05-04-the-number-of-engineers-in-the-swedish-regions-feature-importance_files/figure-html/unnamed-chunk-6-32.png" alt=", Year 2014 - 2018" width="672" />
<p class="caption">
Figure 34: , Year 2014 - 2018
</p>
</div>
<div class="figure"><span id="fig:unnamed-chunk-633"></span>
<img src="/post/2020-05-04-the-number-of-engineers-in-the-swedish-regions-feature-importance_files/figure-html/unnamed-chunk-6-33.png" alt=", Year 2014 - 2018" width="672" />
<p class="caption">
Figure 35: , Year 2014 - 2018
</p>
</div>
<div class="figure"><span id="fig:unnamed-chunk-634"></span>
<img src="/post/2020-05-04-the-number-of-engineers-in-the-swedish-regions-feature-importance_files/figure-html/unnamed-chunk-6-34.png" alt=", Year 2014 - 2018" width="672" />
<p class="caption">
Figure 36: , Year 2014 - 2018
</p>
</div>
<div class="figure"><span id="fig:unnamed-chunk-635"></span>
<img src="/post/2020-05-04-the-number-of-engineers-in-the-swedish-regions-feature-importance_files/figure-html/unnamed-chunk-6-35.png" alt=", Year 2014 - 2018" width="672" />
<p class="caption">
Figure 37: , Year 2014 - 2018
</p>
</div>
<pre><code>## TableGrob (1 x 2) &quot;arrange&quot;: 2 grobs
##   z     cells    name           grob
## 1 1 (1-1,1-1) arrange gtable[layout]
## 2 2 (1-1,2-2) arrange gtable[layout]</code></pre>
